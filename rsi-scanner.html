<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSI SCANNER</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050a0e;
    --panel: #0a1520;
    --border: #1a3a5c;
    --accent: #00d4ff;
    --green: #00ff88;
    --red: #ff3355;
    --yellow: #ffcc00;
    --text: #c8e0f0;
    --dim: #4a7090;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Share Tech Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid bg */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 24px 20px;
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 32px;
    flex-wrap: wrap;
    gap: 16px;
  }

  .title-block h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 48px;
    letter-spacing: 4px;
    color: var(--accent);
    text-shadow: 0 0 20px rgba(0,212,255,0.4);
    line-height: 1;
  }

  .title-block p {
    font-size: 11px;
    color: var(--dim);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  .status-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 11px;
    color: var(--dim);
  }

  .dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--dim);
    transition: all 0.3s;
  }
  .dot.live { background: var(--green); box-shadow: 0 0 8px var(--green); animation: pulse 1.5s infinite; }
  .dot.scanning { background: var(--yellow); box-shadow: 0 0 8px var(--yellow); animation: pulse 0.5s infinite; }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  /* Controls */
  .controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-bottom: 24px;
    padding: 20px;
    background: var(--panel);
    border: 1px solid var(--border);
    clip-path: polygon(0 0, calc(100% - 16px) 0, 100% 16px, 100% 100%, 0 100%);
  }

  .ctrl-group label {
    display: block;
    font-size: 10px;
    color: var(--dim);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .ctrl-group input, .ctrl-group select {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px 10px;
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    outline: none;
    transition: border-color 0.2s;
  }
  .ctrl-group input:focus, .ctrl-group select:focus {
    border-color: var(--accent);
  }
  .ctrl-group select option { background: var(--bg); }

  .scan-btn {
    align-self: flex-end;
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    letter-spacing: 3px;
    padding: 8px 28px;
    cursor: pointer;
    transition: all 0.2s;
    clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 0 100%);
    white-space: nowrap;
  }
  .scan-btn:hover:not(:disabled) {
    background: var(--accent);
    color: var(--bg);
    box-shadow: 0 0 20px rgba(0,212,255,0.4);
  }
  .scan-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* Progress */
  .progress-wrap {
    margin-bottom: 16px;
    display: none;
  }
  .progress-wrap.show { display: block; }
  .progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--dim);
    margin-bottom: 6px;
  }
  .progress-bar {
    height: 3px;
    background: var(--border);
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--green));
    width: 0%;
    transition: width 0.3s;
    box-shadow: 0 0 8px var(--accent);
  }

  /* Stats row */
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--panel);
    border: 1px solid var(--border);
    padding: 12px 16px;
    text-align: center;
  }
  .stat-card .val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    line-height: 1;
    color: var(--accent);
  }
  .stat-card .val.green { color: var(--green); text-shadow: 0 0 10px rgba(0,255,136,0.4); }
  .stat-card .val.red { color: var(--red); text-shadow: 0 0 10px rgba(255,51,85,0.4); }
  .stat-card .lbl {
    font-size: 10px;
    color: var(--dim);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 0;
    margin-bottom: 16px;
    border-bottom: 1px solid var(--border);
  }
  .tab {
    padding: 10px 24px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 18px;
    letter-spacing: 2px;
    cursor: pointer;
    color: var(--dim);
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    margin-bottom: -1px;
  }
  .tab:hover { color: var(--text); }
  .tab.active.oversold { color: var(--green); border-bottom-color: var(--green); }
  .tab.active.overbought { color: var(--red); border-bottom-color: var(--red); }
  .tab.active.all { color: var(--accent); border-bottom-color: var(--accent); }
  .tab .count {
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    margin-left: 6px;
    opacity: 0.7;
  }

  /* Table */
  .table-wrap {
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  thead th {
    text-align: left;
    padding: 10px 12px;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--dim);
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
    cursor: pointer;
    user-select: none;
  }
  thead th:hover { color: var(--text); }

  tbody tr {
    border-bottom: 1px solid rgba(26,58,92,0.4);
    transition: background 0.15s;
    animation: fadeIn 0.3s ease forwards;
    opacity: 0;
  }
  tbody tr:hover { background: rgba(0,212,255,0.04); }

  @keyframes fadeIn { to { opacity: 1; } }

  tbody td {
    padding: 11px 12px;
    white-space: nowrap;
  }

  .symbol {
    color: var(--text);
    font-weight: bold;
    letter-spacing: 1px;
  }
  .symbol span {
    color: var(--dim);
    font-size: 11px;
  }

  .rsi-val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    letter-spacing: 1px;
  }
  .rsi-val.oversold { color: var(--green); }
  .rsi-val.overbought { color: var(--red); }
  .rsi-val.neutral { color: var(--text); }

  .rsi-bar-wrap {
    width: 80px;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
  }
  .rsi-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s;
  }

  .signal-badge {
    display: inline-block;
    padding: 3px 10px;
    font-size: 10px;
    letter-spacing: 2px;
    font-weight: bold;
    text-transform: uppercase;
    clip-path: polygon(4px 0, 100% 0, calc(100% - 4px) 100%, 0 100%);
  }
  .signal-badge.os { background: rgba(0,255,136,0.15); color: var(--green); border: 1px solid rgba(0,255,136,0.3); }
  .signal-badge.ob { background: rgba(255,51,85,0.15); color: var(--red); border: 1px solid rgba(255,51,85,0.3); }

  .price { color: var(--text); }
  .change.pos { color: var(--green); }
  .change.neg { color: var(--red); }

  /* Empty state */
  .empty {
    text-align: center;
    padding: 60px 20px;
    color: var(--dim);
  }
  .empty .big { font-family: 'Bebas Neue', sans-serif; font-size: 48px; color: var(--border); margin-bottom: 12px; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--dim); }
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="title-block">
      <h1>RSI SCANNER</h1>
      <p>Binance USDT Spot · Kendi Tarayıcın</p>
    </div>
    <div class="status-bar">
      <div class="dot" id="statusDot"></div>
      <span id="statusText">HAZIR</span>
    </div>
  </div>

  <div class="controls">
    <div class="ctrl-group">
      <label>Zaman Dilimi</label>
      <select id="interval">
        <option value="5m">5 Dakika</option>
        <option value="15m" selected>15 Dakika</option>
        <option value="1h">1 Saat</option>
        <option value="4h">4 Saat</option>
        <option value="1d">Günlük</option>
      </select>
    </div>
    <div class="ctrl-group">
      <label>RSI Periyot</label>
      <input type="number" id="rsiPeriod" value="14" min="5" max="50">
    </div>
    <div class="ctrl-group">
      <label>Aşırı Satım (≤)</label>
      <input type="number" id="oversoldLevel" value="30" min="10" max="45">
    </div>
    <div class="ctrl-group">
      <label>Aşırı Alım (≥)</label>
      <input type="number" id="overboughtLevel" value="70" min="55" max="90">
    </div>
    <div class="ctrl-group">
      <label>Min. Hacim (USDT)</label>
      <select id="minVolume">
        <option value="0">Tümü</option>
        <option value="500000">500K+</option>
        <option value="1000000" selected>1M+</option>
        <option value="5000000">5M+</option>
        <option value="10000000">10M+</option>
      </select>
    </div>
    <div class="ctrl-group">
      <label>Tarama Yap</label>
      <button class="scan-btn" id="scanBtn" onclick="startScan()">▶ TARA</button>
    </div>
  </div>

  <div class="progress-wrap" id="progressWrap">
    <div class="progress-label">
      <span id="progressText">Taranıyor...</span>
      <span id="progressPct">0%</span>
    </div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </div>

  <div class="stats">
    <div class="stat-card"><div class="val" id="statTotal">—</div><div class="lbl">Taranan Coin</div></div>
    <div class="stat-card"><div class="val green" id="statOS">—</div><div class="lbl">Aşırı Satım</div></div>
    <div class="stat-card"><div class="val red" id="statOB">—</div><div class="lbl">Aşırı Alım</div></div>
    <div class="stat-card"><div class="val" id="statTime">—</div><div class="lbl">Tarama Süresi</div></div>
  </div>

  <div class="tabs" id="tabs">
    <div class="tab active oversold" onclick="showTab('oversold')">AŞIRI SATIM <span class="count" id="countOS">0</span></div>
    <div class="tab overbought" onclick="showTab('overbought')">AŞIRI ALIM <span class="count" id="countOB">0</span></div>
    <div class="tab all" onclick="showTab('all')">TÜMÜ <span class="count" id="countAll">0</span></div>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th onclick="sortBy('symbol')">Sembol</th>
          <th onclick="sortBy('rsi')">RSI</th>
          <th>RSI Bar</th>
          <th>Sinyal</th>
          <th onclick="sortBy('price')">Fiyat</th>
          <th onclick="sortBy('change')">24s Değişim</th>
          <th onclick="sortBy('volume')">24s Hacim</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="7">
          <div class="empty">
            <div class="big">BEKLEMEDE</div>
            <div>TARA butonuna bas, Binance spot piyasasını tarayalım</div>
          </div>
        </td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
let allResults = [];
let currentTab = 'oversold';
let sortKey = 'rsi';
let sortAsc = true;

async function startScan() {
  const btn = document.getElementById('scanBtn');
  btn.disabled = true;
  setStatus('scanning', 'TARANYOR...');
  showProgress(true);

  const interval = document.getElementById('interval').value;
  const period = parseInt(document.getElementById('rsiPeriod').value);
  const osLevel = parseFloat(document.getElementById('oversoldLevel').value);
  const obLevel = parseFloat(document.getElementById('overboughtLevel').value);
  const minVol = parseFloat(document.getElementById('minVolume').value);

  const startTime = Date.now();
  allResults = [];

  try {
    // Get ticker data for all USDT pairs
    updateProgress(5, 'Piyasa verileri alınıyor...');
    const tickerRes = await fetch('https://api.binance.com/api/v3/ticker/24hr');
    const tickers = await tickerRes.json();

    const usdtPairs = tickers
      .filter(t => t.symbol.endsWith('USDT') && parseFloat(t.quoteVolume) >= minVol)
      .sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume))
      .slice(0, 200); // top 200 by volume

    const total = usdtPairs.length;
    document.getElementById('statTotal').textContent = total;

    // Scan each coin
    const BATCH = 10;
    for (let i = 0; i < total; i += BATCH) {
      const batch = usdtPairs.slice(i, i + BATCH);
      await Promise.all(batch.map(t => scanCoin(t, interval, period, osLevel, obLevel)));
      const pct = Math.round(((i + BATCH) / total) * 90) + 5;
      updateProgress(Math.min(pct, 95), `Taraniyor... ${Math.min(i + BATCH, total)}/${total}`);
    }

    updateProgress(100, 'Tamamlandı!');
    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
    document.getElementById('statTime').textContent = elapsed + 's';

    updateStats();
    renderTable();
    setStatus('live', 'TAMAMLANDI');

  } catch (e) {
    setStatus('idle', 'HATA: ' + e.message);
    console.error(e);
  }

  setTimeout(() => showProgress(false), 1500);
  btn.disabled = false;
}

async function scanCoin(ticker, interval, period, osLevel, obLevel) {
  try {
    const symbol = ticker.symbol;
    const limit = period + 10;
    const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
    const klines = await res.json();
    if (!Array.isArray(klines) || klines.length < period + 1) return;

    const closes = klines.map(k => parseFloat(k[4]));
    const rsi = calcRSI(closes, period);
    if (rsi === null) return;

    const price = parseFloat(ticker.lastPrice);
    const change = parseFloat(ticker.priceChangePercent);
    const volume = parseFloat(ticker.quoteVolume);

    let signal = null;
    if (rsi <= osLevel) signal = 'oversold';
    else if (rsi >= obLevel) signal = 'overbought';

    allResults.push({ symbol, rsi, price, change, volume, signal });
  } catch (e) {}
}

function calcRSI(closes, period) {
  if (closes.length < period + 1) return null;
  let gains = 0, losses = 0;
  for (let i = 1; i <= period; i++) {
    const diff = closes[i] - closes[i - 1];
    if (diff > 0) gains += diff;
    else losses += Math.abs(diff);
  }
  let avgGain = gains / period;
  let avgLoss = losses / period;

  for (let i = period + 1; i < closes.length; i++) {
    const diff = closes[i] - closes[i - 1];
    const g = diff > 0 ? diff : 0;
    const l = diff < 0 ? Math.abs(diff) : 0;
    avgGain = (avgGain * (period - 1) + g) / period;
    avgLoss = (avgLoss * (period - 1) + l) / period;
  }

  if (avgLoss === 0) return 100;
  const rs = avgGain / avgLoss;
  return 100 - (100 / (1 + rs));
}

function updateStats() {
  const os = allResults.filter(r => r.signal === 'oversold').length;
  const ob = allResults.filter(r => r.signal === 'overbought').length;
  document.getElementById('statOS').textContent = os;
  document.getElementById('statOB').textContent = ob;
  document.getElementById('countOS').textContent = os;
  document.getElementById('countOB').textContent = ob;
  document.getElementById('countAll').textContent = allResults.filter(r => r.signal).length;
}

function showTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.currentTarget.classList.add('active');
  renderTable();
}

function sortBy(key) {
  if (sortKey === key) sortAsc = !sortAsc;
  else { sortKey = key; sortAsc = true; }
  renderTable();
}

function renderTable() {
  let data = allResults.filter(r => {
    if (currentTab === 'oversold') return r.signal === 'oversold';
    if (currentTab === 'overbought') return r.signal === 'overbought';
    return r.signal !== null;
  });

  data.sort((a, b) => {
    let av = a[sortKey], bv = b[sortKey];
    if (typeof av === 'string') return sortAsc ? av.localeCompare(bv) : bv.localeCompare(av);
    return sortAsc ? av - bv : bv - av;
  });

  const tbody = document.getElementById('tableBody');

  if (data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="7"><div class="empty"><div class="big">SONUÇ YOK</div><div>Kriterlere uyan coin bulunamadı</div></div></td></tr>`;
    return;
  }

  tbody.innerHTML = data.map((r, i) => {
    const rsiClass = r.signal === 'oversold' ? 'oversold' : r.signal === 'overbought' ? 'overbought' : 'neutral';
    const barColor = r.signal === 'oversold' ? 'var(--green)' : r.signal === 'overbought' ? 'var(--red)' : 'var(--accent)';
    const badgeHtml = r.signal === 'oversold'
      ? '<span class="signal-badge os">AŞIRI SATIM</span>'
      : '<span class="signal-badge ob">AŞIRI ALIM</span>';
    const changeClass = r.change >= 0 ? 'pos' : 'neg';
    const changeStr = (r.change >= 0 ? '+' : '') + r.change.toFixed(2) + '%';
    const volStr = r.volume >= 1e9 ? (r.volume/1e9).toFixed(1)+'B' : r.volume >= 1e6 ? (r.volume/1e6).toFixed(1)+'M' : (r.volume/1e3).toFixed(0)+'K';
    const priceStr = r.price < 0.001 ? r.price.toExponential(2) : r.price < 1 ? r.price.toFixed(5) : r.price.toFixed(2);
    const sym = r.symbol.replace('USDT', '');

    return `<tr style="animation-delay:${i*0.03}s">
      <td class="symbol">${sym}<span>/USDT</span></td>
      <td class="rsi-val ${rsiClass}">${r.rsi.toFixed(1)}</td>
      <td><div class="rsi-bar-wrap"><div class="rsi-bar-fill" style="width:${r.rsi}%;background:${barColor}"></div></div></td>
      <td>${badgeHtml}</td>
      <td class="price">${priceStr}</td>
      <td class="change ${changeClass}">${changeStr}</td>
      <td class="price">${volStr}</td>
    </tr>`;
  }).join('');
}

function setStatus(state, text) {
  const dot = document.getElementById('statusDot');
  const txt = document.getElementById('statusText');
  dot.className = 'dot' + (state === 'scanning' ? ' scanning' : state === 'live' ? ' live' : '');
  txt.textContent = text;
}

function showProgress(show) {
  document.getElementById('progressWrap').classList.toggle('show', show);
}

function updateProgress(pct, text) {
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = text;
  document.getElementById('progressPct').textContent = pct + '%';
}
</script>
</body>
</html>
